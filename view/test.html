<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>

    const map = L.map('map').setView([19.9, 99.8], 9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // ตัวอย่างข้อมูล risk ตามอำเภอ — เปลี่ยนตามผลจริงจาก backend ของคุณ
    const riskByDistrict = {

    };

    function getColor(risk) {
        if (risk === "วิกฤต") return "#e74c3c";
        if (risk === "มีความเสี่ยง") return "#f39c12";
        if (risk === "ปกติ") return "#16a085";
        return "#bdc3c7";
    }

    function style(feature) {
        const name = feature.properties.amp_th;
        const risk = riskByDistrict[name] || "ไม่ระบุ";
        return {
            fillColor: getColor(risk),
            weight: 1,
            color: 'white',
            fillOpacity: 0.7
        };
    }

    // ดึง GeoJSON (กรณีกรองเฉพาะเชียงรายไว้แล้ว)
    fetch('http://localhost:3000/chiangrai')
        .then(res => res.json())
        .then(geoData => {
            L.geoJSON(geoData, {
                style: style,
                onEachFeature: (feature, layer) => {
                    const name = feature.properties.amp_th;
                    const risk = riskByDistrict[name] || "ไม่ระบุ";
                    layer.bindPopup(`<b>อำเภอ:</b> ${name}<br><b>ระดับ:</b> ${risk}`);
                }
            }).addTo(map);
        });

    const legend = L.Control.extend({
        options: { position: 'bottomleft' },
        onAdd: function () {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
            <b>ระดับความเสี่ยง</b><br>
            <i style="background:#e74c3c"></i> วิกฤต<br>
            <i style="background:#f39c12"></i> มีความเสี่ยง<br>
            <i style="background:#16a085"></i> ปกติ<br>
            <i style="background:#bdc3c7"></i> ไม่ระบุ<br>
        `;
            return div;
        }
    });
    map.addControl(new legend());


</script>