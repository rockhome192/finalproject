<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV</title>
  <style>
    body {
      font-family: "Kanit", sans-serif;
      background-color: #a3d7a5;
      padding: 40px;
      margin: 0;
    }

    .nav-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .nav-buttons button {
      font-size: 18px;
      background-color: #e7fdd5;
      border: 2px solid #8dc891;
      border-radius: 12px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }

    .nav-buttons button.active {
      background-color: orange;
      color: white;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 30px;
      width: 500px;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    h2 {
      margin-bottom: 20px;
    }

    input[type="file"] {
      padding: 10px;
      font-size: 16px;
    }

    button[type="submit"] {
      background-color: #8dc891;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    #loading {
      display: none;
      margin-top: 20px;
      font-weight: bold;
      color: #555;
    }

    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid #ccc;
      border-top-color: #333;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>   

  <div class="nav-buttons">
    <button onclick="window.location.href='/index'">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button>
    <button onclick="window.location.href='/chart'">‡∏Å‡∏£‡∏≤‡∏ü</button>
    <button onclick="window.location.href='/table'">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button onclick="window.location.href='/upload'">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button onclick="location.href='/logout'" style="background-color: orange; color: white;">‡∏≠‡∏≠‡∏Å</button>
  </div>

  <div class="card">
    <h2>üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV</h2>
    <form id="uploadForm">
      <input type="file" name="csvFile" accept=".csv" required><br>
      <button type="submit">Upload</button>
    </form>

    <div id="loading">
      <span class="spinner"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
    </div>
  </div>

  <script>
  const form = document.getElementById('uploadForm');
  const loading = document.getElementById('loading');

  form.addEventListener('submit', async (e) => {
    e.preventDefault(); // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
    loading.style.display = 'block';

    const formData = new FormData(form);
    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });
      const result = await response.json();

      // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô loading ‡∏Å‡πà‡∏≠‡∏ô alert
      loading.style.display = 'none';

      // ‚úÖ ‡∏Ñ‡πà‡∏≠‡∏¢‡πÅ‡∏™‡∏î‡∏á alert ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å loading ‡∏´‡∏≤‡∏¢
      if (result.status === 'success') {
        alert(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${result.inserted} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
      } else {
        alert(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}`);
      }
    } catch (err) {
      loading.style.display = 'none';
      alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ');
      console.error(err);
    }
  });
</script>

</body>
</html>
